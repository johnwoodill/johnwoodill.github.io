<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Content</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">A. JOHN WOODILL</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="cv.html">
    <span class="fa fa-file"></span>
     
    CV
  </a>
</li>
<li>
  <a href="research.html">
    <span class="fa fa-globe"></span>
     
    Research
  </a>
</li>
<li>
  <a href="http://www.github.com/johnwoodill/">
    <span class="fa fa-git"></span>
     
    hub
  </a>
</li>
<li>
  <a href="https://scholar.google.com/citations?user=FOD51c4AAAAJ&amp;hl=en">
    <span class="fa fa-graduation-cap"></span>
     
    Google Scholar
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Content</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#econometrics">Econometrics</a><ul>
<li><a href="#regression-weighting">Regression Weighting</a></li>
</ul></li>
<li><a href="#spatial-visualization">Spatial Visualization</a><ul>
<li><a href="#interpolating-contour-maps">Interpolating Contour Maps</a></li>
</ul></li>
</ul>
</div>

<hr />
<p><br></p>
<div id="econometrics" class="section level2">
<h2>Econometrics</h2>
<hr />
<div id="regression-weighting" class="section level3">
<h3>Regression Weighting</h3>
<p><strong>Types of weighting</strong></p>
<ul>
<li>Analytic Weights : Useful when dealing with averages in data by providing a proportional weight given number of obs.</li>
<li>Sampling Weights (Inverse Probability Weights) : Useful when dealing with data that has missing values.</li>
</ul>
<p><code>Stata</code> makes this very easy by just attaching <code>aweight</code> or <code>pweight</code> to the end of the regression line. However, in <code>R</code>, it requires a bit of understanding for each packages. The <code>lm()</code> function only does analytic weighting, but for sampling weights, the <code>survey</code> package is used to to build a survey design object and run <code>glm()</code>. By default, the <code>survey</code> package uses sampling weights.</p>
<p><strong>Sample data.frame (from <code>dput</code>)</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">  data &lt;-<span class="st"> </span><span class="kw">structure</span>(<span class="kw">list</span>(<span class="dt">lexptot =</span> <span class="kw">c</span>(<span class="fl">9.1595012302023</span>, <span class="fl">9.86330744180814</span>, </a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="fl">8.92372556833205</span>, <span class="fl">8.58202430280175</span>, <span class="fl">10.1133857229336</span>), <span class="dt">progvillm =</span> <span class="kw">c</span>(1L, </a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  1L, 1L, 1L, 0L), <span class="dt">sexhead =</span> <span class="kw">c</span>(1L, 1L, 0L, 1L, 1L), <span class="dt">agehead =</span> <span class="kw">c</span>(79L, </a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  43L, 52L, 48L, 35L), <span class="dt">weight =</span> <span class="kw">c</span>(<span class="fl">1.04273509979248</span>, <span class="fl">1.01139605045319</span>, </a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  <span class="fl">1.01139605045319</span>, <span class="fl">1.01139605045319</span>, <span class="fl">0.76305216550827</span>)), <span class="dt">.Names =</span> <span class="kw">c</span>(<span class="st">&quot;lexptot&quot;</span>, </a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="st">&quot;progvillm&quot;</span>, <span class="st">&quot;sexhead&quot;</span>, <span class="st">&quot;agehead&quot;</span>, <span class="st">&quot;weight&quot;</span>), <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;tbl_df&quot;</span>, </a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="st">&quot;tbl&quot;</span>, <span class="st">&quot;data.frame&quot;</span>), <span class="dt">row.names =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="op">-</span>5L))</a></code></pre></div>
<p><strong>Analytic Weights</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">lm.analytic &lt;-<span class="st"> </span><span class="kw">lm</span>(lexptot <span class="op">~</span><span class="st"> </span>progvillm <span class="op">+</span><span class="st"> </span>sexhead <span class="op">+</span><span class="st"> </span>agehead, <span class="dt">data =</span> data, <span class="dt">weight =</span> weight)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">summary</span>(lm.analytic)</a></code></pre></div>
<p><strong>Output</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">Call<span class="op">:</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">lm</span>(<span class="dt">formula =</span> lexptot <span class="op">~</span><span class="st"> </span>progvillm <span class="op">+</span><span class="st"> </span>sexhead <span class="op">+</span><span class="st"> </span>agehead, <span class="dt">data =</span> data, </a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    <span class="dt">weights =</span> weight)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">Weighted Residuals<span class="op">:</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="st">         </span><span class="dv">1</span>          <span class="dv">2</span>          <span class="dv">3</span>          <span class="dv">4</span>          <span class="dv">5</span> </a>
<a class="sourceLine" id="cb3-7" data-line-number="7"> <span class="fl">9.249e-02</span>  <span class="fl">5.823e-01</span>  <span class="fl">0.000e+00</span> <span class="fl">-6.762e-01</span> <span class="fl">-1.527e-16</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">Coefficients<span class="op">:</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="st">             </span>Estimate Std. Error t value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>t<span class="op">|</span>)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">(Intercept) <span class="fl">10.016054</span>   <span class="fl">1.744293</span>   <span class="fl">5.742</span>    <span class="fl">0.110</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">progvillm   <span class="fl">-0.781204</span>   <span class="fl">1.344974</span>  <span class="fl">-0.581</span>    <span class="fl">0.665</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13">sexhead      <span class="fl">0.306742</span>   <span class="fl">1.040625</span>   <span class="fl">0.295</span>    <span class="fl">0.818</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">agehead     <span class="fl">-0.005983</span>   <span class="fl">0.032024</span>  <span class="fl">-0.187</span>    <span class="fl">0.882</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"></a>
<a class="sourceLine" id="cb3-16" data-line-number="16">Residual standard error<span class="op">:</span><span class="st"> </span><span class="fl">0.8971</span> on <span class="dv">1</span> degrees of freedom</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">Multiple R<span class="op">-</span>squared<span class="op">:</span><span class="st">  </span><span class="fl">0.467</span>, Adjusted R<span class="op">-</span>squared<span class="op">:</span><span class="st">  </span><span class="fl">-1.132</span> </a>
<a class="sourceLine" id="cb3-18" data-line-number="18">F<span class="op">-</span>statistic<span class="op">:</span><span class="st"> </span><span class="fl">0.2921</span> on <span class="dv">3</span> and <span class="dv">1</span> DF,  p<span class="op">-</span>value<span class="op">:</span><span class="st"> </span><span class="fl">0.8386</span></a></code></pre></div>
<p><strong>Sampling Weights (IPW)</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">data<span class="op">$</span>X &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(data)             <span class="co"># Create unique id</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co"># Build survey design object with unique id, ipw, and data.frame</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">des1 &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">id =</span> <span class="op">~</span>X,  <span class="dt">weights =</span> <span class="op">~</span>weight, <span class="dt">data =</span> data)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co"># Run glm with survey design object</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">prog.lm &lt;-<span class="st"> </span><span class="kw">svyglm</span>(lexptot <span class="op">~</span><span class="st"> </span>progvillm <span class="op">+</span><span class="st"> </span>sexhead <span class="op">+</span><span class="st"> </span>agehead, <span class="dt">design=</span>des1)</a></code></pre></div>
<p><strong>Output :</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">Call<span class="op">:</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">svyglm</span>(<span class="dt">formula =</span> lexptot <span class="op">~</span><span class="st"> </span>progvillm <span class="op">+</span><span class="st"> </span>sexhead <span class="op">+</span><span class="st"> </span>agehead, <span class="dt">design =</span> des1)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">Survey design<span class="op">:</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">svydesign</span>(<span class="dt">id =</span> <span class="op">~</span>X, <span class="dt">weights =</span> <span class="op">~</span>weight, <span class="dt">data =</span> data)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">Coefficients<span class="op">:</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="st">             </span>Estimate Std. Error t value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>t<span class="op">|</span>)  </a>
<a class="sourceLine" id="cb5-9" data-line-number="9">(Intercept) <span class="fl">10.016054</span>   <span class="fl">0.183942</span>  <span class="fl">54.452</span>   <span class="fl">0.0117</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">progvillm   <span class="fl">-0.781204</span>   <span class="fl">0.640372</span>  <span class="fl">-1.220</span>   <span class="fl">0.4371</span>  </a>
<a class="sourceLine" id="cb5-11" data-line-number="11">sexhead      <span class="fl">0.306742</span>   <span class="fl">0.397089</span>   <span class="fl">0.772</span>   <span class="fl">0.5813</span>  </a>
<a class="sourceLine" id="cb5-12" data-line-number="12">agehead     <span class="fl">-0.005983</span>   <span class="fl">0.014747</span>  <span class="fl">-0.406</span>   <span class="fl">0.7546</span>  </a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="op">---</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14">Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> ‘<span class="op">**</span><span class="er">*</span>’ <span class="fl">0.001</span> ‘<span class="op">**</span>’ <span class="fl">0.01</span> ‘<span class="op">*</span>’ <span class="fl">0.05</span> ‘.’ <span class="fl">0.1</span> ‘ ’ <span class="dv">1</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"></a>
<a class="sourceLine" id="cb5-16" data-line-number="16">(Dispersion parameter <span class="cf">for</span> gaussian family taken to be <span class="fl">0.2078647</span>)</a>
<a class="sourceLine" id="cb5-17" data-line-number="17"></a>
<a class="sourceLine" id="cb5-18" data-line-number="18">Number of Fisher Scoring iterations<span class="op">:</span><span class="st"> </span><span class="dv">2</span></a></code></pre></div>
<p>Note that the coefficients are the same, but the standard errors have been reduced from the analytic weighting.</p>
<hr />
</div>
</div>
<div id="spatial-visualization" class="section level2">
<h2>Spatial Visualization</h2>
<div id="interpolating-contour-maps" class="section level3">
<h3>Interpolating Contour Maps</h3>
<p>Some prelimimary research has lead me into the world of Spatial Plotting in R. Below is a small example of average precipitation in California during 2000. The code consists of building spatial objects, interpolation of data points, and then plotting with ggplot2. For simplicity, the data has already been manipulated, tidied and provided below. Source for data is from <a href="http://www.prism.oregonstate.edu/">PRISM</a></p>
<p><strong>Data set (164 mb)</strong> : <a href="https://www.dropbox.com/s/zwoq0ekpnh6be4a/CA_2000_appt.csv?dl=0">CA_2000_appt.csv</a></p>
<p><strong>R Code</strong> : <a href="code/California.R">California.R</a></p>
<p><strong><em>Libraries</em></strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">    <span class="kw">library</span>(plyr)      <span class="co"># Data manipulation </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">    <span class="kw">library</span>(dplyr)     <span class="co"># Data manipulation </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="kw">library</span>(ggplot2)   <span class="co"># Final Plot  </span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    <span class="kw">library</span>(automap)   <span class="co"># For Spacial Data</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    <span class="kw">library</span>(akima)     <span class="co"># For interpolation</span></a></code></pre></div>
<p><strong>Creating Spatial Object</strong></p>
<p>The first step is to build a spatial object consisting of California latitude and longitude coordinates for the entire state. This will allow the object to be plotted correctly with the precipitation spatial points built below.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">    CA_<span class="dv">2000</span>_appt &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;CA_2000_appt.csv&quot;</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">    sub_data =<span class="st"> </span><span class="kw">as.data.frame</span>(CA_<span class="dv">2000</span>_appt)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    coord_vars =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;latitude&quot;</span>,<span class="st">&quot;longitude&quot;</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    data_vars =<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">colnames</span>(sub_data), coord_vars)         <span class="co"># All colnames except for Lat/Long</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    sp_points =<span class="st"> </span><span class="kw">SpatialPoints</span>(sub_data[,coord_vars])            <span class="co"># All lat/long in Spatial Point format</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    sp_df =<span class="st"> </span><span class="kw">SpatialPointsDataFrame</span>(sp_points,           <span class="co"># Spatial Data Frame of lat/long and remaining cols</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">                                     sub_data[,data_vars,<span class="dt">drop=</span><span class="ot">FALSE</span>])    </a>
<a class="sourceLine" id="cb7-8" data-line-number="8">    regions &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;california&quot;</span>)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">    map_base_data &lt;-<span class="st"> </span><span class="kw">filter</span>(<span class="kw">map_data</span>(<span class="st">&quot;state&quot;</span>), region <span class="op">==</span><span class="st"> &quot;california&quot;</span>)   <span class="co"># Get California lat/long coord.</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">    map_base_data &lt;-<span class="st"> </span><span class="kw">rename</span>(map_base_data, <span class="dt">longitude =</span> long)             <span class="co"># Rename columns</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">    map_base_data &lt;-<span class="st"> </span><span class="kw">rename</span>(map_base_data, <span class="dt">latitude =</span> lat)</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb7-13" data-line-number="13">    <span class="co"># Creates a Spatial Polygon for each state with lat/long</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">    <span class="co"># ---&gt; Used for plotting the map</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb7-16" data-line-number="16">    state_regions =<span class="st"> </span><span class="cf">function</span>(x) {        <span class="co"># Gets lat/long for each state to build Spatial Polygon</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17">      state =<span class="st"> </span><span class="kw">unique</span>(x<span class="op">$</span>region)</a>
<a class="sourceLine" id="cb7-18" data-line-number="18">      <span class="kw">print</span>(state)</a>
<a class="sourceLine" id="cb7-19" data-line-number="19">      <span class="kw">Polygons</span>(<span class="kw">list</span>(<span class="kw">Polygon</span>(x[,<span class="kw">c</span>(<span class="st">&quot;latitude&quot;</span>,<span class="st">&quot;longitude&quot;</span>)])),<span class="dt">ID=</span>state)</a>
<a class="sourceLine" id="cb7-20" data-line-number="20">    }   </a>
<a class="sourceLine" id="cb7-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb7-22" data-line-number="22">    state_pg =<span class="st"> </span><span class="kw">SpatialPolygons</span>(<span class="kw">dlply</span>(map_base_data,     <span class="co"># Builds a Spatial Polygon of all state/regions</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23">                                     .(region), </a>
<a class="sourceLine" id="cb7-24" data-line-number="24">                                     state_regions))  </a></code></pre></div>
<p><strong>Spline Interpolation with akima package</strong></p>
<p>Next, additional data points need to be interpolated from the given values in the data.frame in order to increase the clarity on the map. The steps for this section of code include interpolating the data, melting each lat/long for each interpolated appt, building the data.frame, and merging the California Spatial data.frame from above, with the original appt and interpolated points.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">    fld =<span class="st"> </span><span class="kw">with</span>(sub_data, <span class="kw">interp</span>(<span class="dt">x =</span> longitude, <span class="dt">y =</span> latitude, <span class="dt">z =</span> APPT, <span class="dt">duplicate=</span><span class="st">&quot;median&quot;</span>,</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">                                <span class="dt">xo=</span><span class="kw">seq</span>(<span class="kw">min</span>(map_base_data<span class="op">$</span>longitude), </a>
<a class="sourceLine" id="cb8-3" data-line-number="3">                                       <span class="kw">max</span>(map_base_data<span class="op">$</span>longitude), <span class="dt">length =</span> <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">                                <span class="dt">yo=</span><span class="kw">seq</span>(<span class="kw">min</span>(map_base_data<span class="op">$</span>latitude), </a>
<a class="sourceLine" id="cb8-5" data-line-number="5">                                       <span class="kw">max</span>(map_base_data<span class="op">$</span>latitude), <span class="dt">length =</span> <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">                                <span class="dt">extrap=</span><span class="ot">TRUE</span>, <span class="dt">linear=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">    melt_x =<span class="st"> </span><span class="kw">rep</span>(fld<span class="op">$</span>x, <span class="dt">times=</span><span class="kw">length</span>(fld<span class="op">$</span>y))                        <span class="co"># Pull out longitude values from list</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">    melt_y =<span class="st"> </span><span class="kw">rep</span>(fld<span class="op">$</span>y, <span class="dt">each=</span><span class="kw">length</span>(fld<span class="op">$</span>x))                         <span class="co"># Pull out latitude values from list</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">    melt_z =<span class="st"> </span><span class="kw">as.vector</span>(fld<span class="op">$</span>z)                                       <span class="co"># Pull out appt values from list</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">    level_data =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">longitude=</span>melt_x,                       <span class="co"># Build data.frame</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11">                            <span class="dt">latitude=</span>melt_y, </a>
<a class="sourceLine" id="cb8-12" data-line-number="12">                            <span class="dt">APPT=</span>melt_z)                                        </a>
<a class="sourceLine" id="cb8-13" data-line-number="13">    interp_data =<span class="st"> </span><span class="kw">na.omit</span>(level_data)                               <span class="co"># Remove all NA values</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14">    grid_points =<span class="st"> </span><span class="kw">SpatialPoints</span>(interp_data[,<span class="dv">2</span><span class="op">:</span><span class="dv">1</span>])                  <span class="co"># Build Spatial Points into object</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15">    in_points =<span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(<span class="kw">over</span>(grid_points,state_pg))  <span class="co"># Logical determining points inside all regions </span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16">    inside_points =<span class="st"> </span>interp_data[in_points, ]        <span class="co"># Removes all points outside of Spatial Polygons</span></a></code></pre></div>
<p><strong>Plot Spatial Objects with ggplot2</strong></p>
<p>And finally, build the aesthetics for ggplot2, overlay appt, contour appt concentrations, title plot, and apply border.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">    map_base_aesthetics =<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x=</span>longitude, <span class="dt">y=</span>latitude, <span class="dt">group=</span>group)    <span class="co"># Aesthetics for ggplot2</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    map_base =<span class="st"> </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>map_base_data, map_base_aesthetics)   <span class="co"># Map Base</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">    borders =<span class="st"> </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>map_base_data,                         <span class="co"># Draws boundaries</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">                           map_base_aesthetics, </a>
<a class="sourceLine" id="cb9-5" data-line-number="5">                           <span class="dt">color=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="ot">NA</span>)    </a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    <span class="kw">ggplot</span>(<span class="dt">data=</span>inside_points, <span class="kw">aes</span>(<span class="dt">x=</span>longitude, <span class="dt">y=</span>latitude))  <span class="op">+</span><span class="st">      </span><span class="co"># Setup ggplot2</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="st">      </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>APPT)) <span class="op">+</span><span class="st">                                    </span><span class="co"># Initial overlay of appt</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="st">      </span><span class="kw">stat_contour</span>(<span class="kw">aes</span>(<span class="dt">z=</span>APPT)) <span class="op">+</span><span class="st">                                    </span><span class="co"># Create contours for concentrations</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="st">      </span><span class="kw">coord_equal</span>() <span class="op">+</span><span class="st">                                                </span><span class="co"># Equalize plots</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="st">      </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">low=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">mid=</span><span class="st">&quot;white&quot;</span>,<span class="dt">high=</span><span class="st">&quot;darkgreen&quot;</span>, <span class="co"># Set colors for low, mid, high</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">                           <span class="dt">midpoint=</span><span class="kw">mean</span>(inside_points<span class="op">$</span>APPT)) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="st">      </span><span class="kw">ggtitle</span>(<span class="st">&quot;California Precipitation - 2000&quot;</span>) <span class="op">+</span><span class="st">                  </span><span class="co"># Plot title</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="st">      </span>borders                                                       <span class="co"># Draw California border</span></a></code></pre></div>
<p>image: <img src="images/California_appt.png" alt="California-2000" /></p>
<p><strong>References</strong></p>
<p>Thanks to <span class="citation">@kdauria</span> on Stack Exchange for helping with the code for interpolation and countour plots.</p>
<p><a href="http://cran.r-project.org/web/views/Spatial.html">CRAN Task View: Analysis of Spatial Data</a></p>
<p><a href="http://cran.r-project.org/doc/contrib/intro-spatial-rl.pdf">Introduction to Visualising Spatial Data in R</a></p>
<p><a href="http://www.amazon.com/R-Book-Michael-J-Crawley/dp/0470973927/ref=sr_1_1?ie=UTF8&amp;qid=1422422058&amp;sr=8-1&amp;keywords=The+R+Book&amp;pebp=1422422059942&amp;peasin=470973927">The R Book - Michael J. Crawley</a></p>
<p><a href="http://docs.ggplot2.org/current/">ggplot2 Help Topics</a></p>
<p><strong>Examples</strong></p>
<p><a href="http://www.sharpsightlabs.com/mapping-seattle-crime/">Mapping Seattle Crime</a></p>
<p><a href="http://www.sharpsightlabs.com/mapping-san-francisco-crime/">Mapping San Francisco Crime</a></p>
<p><a href="http://nrelscience.org/2013/05/30/this-is-how-i-did-it-mapping-in-r-with-ggplot2/">this is how i did it…mapping in r with ggplot2</a></p>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61017136-2', 'auto');
  ga('send', 'pageview');

</script>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
